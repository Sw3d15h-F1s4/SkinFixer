import org.apache.tools.ant.filters.ReplaceTokens
import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

plugins {
    id 'java'
    id 'eclipse'
    id 'com.github.johnrengelman.shadow' version '5.0.0'
    
}

allprojects {

	version = pluginVersion
	group = pluginGroup	

	sourceCompatibility = 1.8
	targetCompatibility = 1.8

	repositories {
		jcenter()
		mavenCentral()
  	  	maven{ url "https://hub.spigotmc.org/nexus/content/repositories/snapshots" }
   	 	maven{ url "https://oss.sonatype.org/content/repositories/snapshots" }
   	 	maven{ url 'https://jitpack.io' }
    }
    
	processResources {
    	from(sourceSets.main.resources.srcDirs) {
        	filter ReplaceTokens, tokens: [version: version]
			filter ReplaceTokens, tokens: [name: pluginName]
			filter ReplaceTokens, tokens: [groupId: pluginGroup]
			filter ReplaceTokens, tokens: [author: pluginAuthor]
			filter ReplaceTokens, tokens: [apiVersion: pluginApiVersion]
		}
    }
}

dependencies {
	//HTTP client
    compile 'com.github.TheDutchMC:HttpLib:1.1'
	
	//Logging framework
	compile 'org.slf4j:slf4j-log4j12:1.7.29'
	
	//JSON
    compile 'com.google.code.gson:gson:2.8.6'
	
	//JDA
	compile('net.dv8tion:JDA:4.2.0_168') {
		exclude module: 'opus-java' 
	}
	
	//Spigot API
	compileOnly 'org.spigotmc:spigot-api:1.16.1-R0.1-SNAPSHOT'
	
	compile 'dev.array21:classvalidator:1.0.0'

}

shadowJar() {
 	classifier = ''
	relocate 'net.dv8tion.jda', 'nl.thedutchmc.skinfixer.libs.net.dv8tion.jda'
	relocate 'com.google.code.gson', 'nl.thedutchmc.skinfixer.libs.com.google.code.gson'
	relocate 'nl.thedutchmc.httplib', 'nl.thedutchmc.skinfixer.libs.nl.thedutchmc.httplib'
	relocate 'org.slf4j', 'nl.thedutchmc.skinfixer.libs.org.slf4j'
	relocate 'dev.array21.classvalidator', 'nl.thedutchmc.skinfixer.libs.dev.array21.classvalidator'
}

task testJar(type: ShadowJar) {
	
	relocate 'net.dv8tion.jda', 'nl.thedutchmc.libs.jda'

	
	description 'Build a test Jar'
	archiveClassifier = 'DEV'
	from sourceSets.main.output
	configurations = [project.configurations.runtime]
	destinationDirectory = file("$rootDir/server/plugins")
}

task releaseJar(type: ShadowJar) {

	relocate 'net.dv8tion.jda', 'nl.thedutchmc.libs.jda'

	description 'Build a release Jar'
	archiveClassifier = 'RELEASE'
	from sourceSets.main.output
	configurations = [project.configurations.runtime]
	destinationDirectory = file("$rootDir/releases")
}